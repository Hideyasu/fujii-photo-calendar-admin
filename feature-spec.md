# 機能仕様定義

## 機能名

藤井写真館 写真管理システム（Admin 側）

## 概要

藤井写真館の管理者が、顧客の写真を管理し、カレンダー × デジタルフォトフレームアプリ（クライアント側）と連携して継続的な来店を促進するための管理システム。Firebase 認証を使用し、顧客情報の管理、写真のアップロード・管理、キャンペーン配信などを行う。

## ユーザーストーリー

### メインストーリー

- **誰が**: 藤井写真館のスタッフ（管理者）
- **何を**: 顧客の写真を効率的に管理し、アプリを通じて配信したい
- **なぜ**: 顧客の継続的な来店を促進し、写真館の利用率を向上させるため

### 使用シナリオ

1. 撮影後、管理者が顧客情報を登録し、撮影した写真を一括アップロード
2. 写真に撮影日やタイトルを設定し、顧客のアカウントに紐付け
3. 定期的にキャンペーン情報を配信し、再来店を促進
4. 顧客の利用状況を確認し、フォローアップを実施

## 機能要件

### 必須要件

- [ ] **認証機能**: Firebase Authentication による管理者認証
- [ ] **写真アップロード**: 複数写真の一括アップロード（ドラッグ&ドロップ対応）
- [ ] **写真メタデータ管理**: 撮影日、タイトル、メモの設定
- [ ] **写真と顧客の紐付け**: アップロードした写真を特定の顧客に関連付け
- [ ] **写真削除機能**: 不要な写真の削除

### オプション要件

- [ ] **統計ダッシュボード**: 顧客の利用状況、写真閲覧数の可視化
- [ ] **一括操作**: 複数顧客への写真一括配信
- [ ] **バックアップ機能**: 写真データの定期バックアップ
- [ ] **閲覧者管理**: 祖父母など閲覧者の情報管理

## 受け入れ条件

### 正常系

- **前提条件**: 管理者としてログイン済み
- **操作**: 写真を選択し、顧客 A に紐付けてアップロード
- **期待結果**:
  - 写真が Firebase Storage に保存される

### 異常系/エッジケース

- **エラーケース 1**: 大容量ファイル（10MB 以上）のアップロード時は圧縮処理を実行
- **エラーケース 2**: 顧客未選択での写真アップロードはできないようにする

## データ/エンティティ

### 主要なデータ

- **User（顧客）**:
  - ID、名前、メールアドレス、電話番号
  - ロール（admin/user）
  - 登録日、最終来店日
- **Photo（写真）**:
  - ID、URL、撮影日、アップロード日
  - タイトル、メモ、サイズ
  - 顧客 ID（紐付け）、表示優先度
- **Campaign（キャンペーン）**:
  - ID、タイトル、内容
  - 開始日、終了日、対象顧客

### データの関係性

- 1 人の顧客に対して複数の写真を紐付け（1:N）
- 1 つのキャンペーンは複数の顧客に配信（1:N）
- 顧客は複数の閲覧者を持つ（1:N）

## 制約事項

### ビジネス制約

- 顧客の個人情報保護の徹底
- 写真の著作権は藤井写真館に帰属

### 技術制約

- Firebase の利用（Authentication, Firestore, Storage）
- Web ベースのレスポンシブ対応
- 画像形式：JPEG, PNG, HEIF 対応
- 最大アップロードサイズ：50MB/ファイル

### 技術スタック

- **フレームワーク**: SvelteKit
- **言語**: JavaScript
- **スタイリング**: Tailwind CSS
- **UI コンポーネント**: Skeleton UI
- **状態管理**: Svelte Store

### デプロイ要件

- **ホスティング**: Vercel
- **ビルド設定**:
  - フレームワーク: SvelteKit
  - Node.js バージョン: 18.x 以上
  - ビルドコマンド: `npm run build` または `vite build`
  - アダプター: @sveltejs/adapter-vercel
- **環境変数**:
  - Firebase 設定（API Key, Auth Domain, Project ID 等）
- **デプロイ方式**:
  - GitHub 連携による自動デプロイ
  - main ブランチへのプッシュで本番環境へ自動デプロイ
  - プルリクエストごとにプレビュー環境の自動生成
- **パフォーマンス要件**:
  - Lighthouse スコア: 90 以上
  - 初回読み込み: 3 秒以内
  - CDN による画像配信の最適化

## 画面構成

### 主要画面

1. **ログイン画面**

   - Firebase Authentication によるメール/パスワード認証
   - パスワードリセット機能

2. **ダッシュボード**

   - 最近アップロードした写真の一覧
   - 顧客数・写真数などの統計情報
   - 直近の活動ログ

3. **顧客管理画面**

   - 顧客一覧（検索・フィルター機能付き）
   - 顧客詳細（基本情報・写真履歴・来店履歴）
   - 新規顧客登録フォーム

4. **写真管理画面**

   - 写真アップロードエリア（ドラッグ&ドロップ対応）
   - アップロード済み写真のギャラリー表示
   - 写真の編集（メタデータ・顧客紐付け）
   - 一括選択・削除機能

5. **キャンペーン管理画面**（オプション）
   - キャンペーン一覧
   - キャンペーン作成・編集フォーム
   - 配信対象顧客の選択

### UI/UX 要件

- **レスポンシブデザイン**: PC・タブレット・スマホ対応
- **ダークモード**: システム設定に応じた切り替え
- **アクセシビリティ**: WCAG 2.1 Level AA 準拠
- **多言語対応**: 日本語・英語（将来的）

## セキュリティ要件

### 認証・認可

- **多要素認証（MFA）**: 管理者アカウントには必須
- **ロール管理**: admin/client の 2 段階

### データ保護

- **通信**: HTTPS 必須（SSL/TLS 1.3 以上）
- **画像アクセス制御**: 署名付き URL（有効期限付き）
- **個人情報暗号化**: Firestore のセキュリティルール設定
- **監査ログ**: 全ての更新操作を記録

### コンプライアンス

- **個人情報保護法**: 準拠

## API 仕様（概要）

### クライアントアプリとの連携

- **認証 API**: Firebase Auth トークンによる認証
- **写真取得 API**:
  - GET /api/photos/{userId}
  - クエリパラメータ: month, limit
- **通知 API**: Firebase Cloud Messaging

### レート制限

- API コール: 100 リクエスト/分
- アップロード: 50MB/ファイル、100 ファイル/日

## 成功指標

- 管理者の写真アップロード作業時間を 50%削減
- 顧客の再来店率を 30%向上
- システム稼働率 99.9%以上
- 写真アップロードから顧客通知まで 1 分以内

## 備考

- 将来的に AI 機能（顔認識による自動タグ付けなど）の追加を検討
